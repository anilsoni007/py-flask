name: Deploy to Sandbox Instance
on:
  push:
      branches: 
        - sandbox
  workflow_run: 
    workflows: [python-panda-app]
    types:
      - completed
  
jobs:
  deploy-to-sandbox:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: checkout repo
        uses: actions/checkout@v4

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v3
        with:
          role-to-assume: ${{ secrets.AWS_SANDBOX_ROLE }}
          aws-region: ap-south-1

      - name: build docker image
        run: docker build -t ${{ env.ECR_REG }}:${{ github.sha }} .

      - name: push to ECR
        run: docker push ${{ env.ECR_REG }}:${{ github.sha }} 

      
